{% extends "page_layout.html" %} {% block main_content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">Welcome, {{user.get('username', '')}}!</h1>
</div>

<section class="d-flex justify-content-between mb-4">
  <a href="{{ url_for('debts_page') }}" class="text-decoration-none w-50 me-2">
    <div class="card text-white bg-danger shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Debts <i class="fa-solid fa-arrow-up"></i></h5>
        <p class="card-text fs-4">₦{{user.get('debts_display', '0.00')}}</p>
      </div>
    </div>
  </a>

  <a href="{{ url_for('dough_page') }}" class="text-decoration-none w-50 ms-2">
    <div class="card text-white bg-success shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Dough <i class="fa-solid fa-arrow-down"></i></h5>
        <p class="card-text fs-4">₦{{user.get('dough_display', '0.00')}}</p>
      </div>
    </div>
  </a>
</section>

<section class="row mt-4">
  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-header">Debt Trends</div>
      <div class="card-body">
        <div id="debtChart" style="height: 400px"></div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-header">Dough Trends</div>
      <div class="card-body">
        <div id="doughChart" style="height: 400px"></div>
      </div>
    </div>
  </div>
</section>

<script>
  // Chart data will be populated by Flask
  const debtData = {{ debt_chart_data | tojson }};
  const doughData = {{ dough_chart_data | tojson }};

  // Render Debt Chart
  var debtOptions = {
    series: [{
      name: 'Debt Amount',
      data: debtData.values
    }],
    chart: {
      height: 350,
      type: 'line',
      zoom: {
        enabled: true
      }
    },
    dataLabels: {
      enabled: false
    },
    stroke: {
      curve: 'smooth'
    },
    title: {
      text: 'Debt Trends',
      align: 'left'
    },
    grid: {
      row: {
        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
        opacity: 0.5
      },
    },
    xaxis: {
      categories: debtData.labels,
    },
    tooltip: {
        y: {
            formatter: function (val) {
                return "₦ " + val
            }
        }
    }
  };

  var debtChart = new ApexCharts(document.querySelector("#debtChart"), debtOptions);
  debtChart.render();

  // Render Dough Chart
  var doughOptions = {
    series: [{
      name: 'Dough Amount',
      data: doughData.values
    }],
    chart: {
      height: 350,
      type: 'line',
      zoom: {
        enabled: true
      }
    },
    dataLabels: {
      enabled: false
    },
    stroke: {
      curve: 'smooth'
    },
    title: {
      text: 'Dough Trends',
      align: 'left'
    },
    grid: {
      row: {
        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
        opacity: 0.5
      },
    },
    xaxis: {
      categories: doughData.labels,
    },
    tooltip: {
        y: {
            formatter: function (val) {
                return "₦ " + val
            }
        }
    }
  };

  var doughChart = new ApexCharts(document.querySelector("#doughChart"), doughOptions);
  doughChart.render();
</script>

{% endblock %}
