{% extends "page_layout.html" %}
{% block main_content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Welcome, {{user.get('username', '')}}!</h1>
</div>

<section class="d-flex justify-content-between mb-4">
    <a href="{{ url_for('debts_page') }}" class="text-decoration-none w-50 me-2">
        <div class="card text-white bg-danger shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Debts <i class="fa-solid fa-arrow-up"></i></h5>
                <p class="card-text fs-4">₦{{user.get('debts_display', '0.00')}}</p>
            </div>
        </div>
    </a>

    <a href="{{ url_for('dough_page') }}" class="text-decoration-none w-50 ms-2">
        <div class="card text-white bg-success shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Dough <i class="fa-solid fa-arrow-down"></i></h5>
                <p class="card-text fs-4">₦{{user.get('dough_display', '0.00')}}</p>
            </div>
        </div>
    </a>
</section>

<section class="row mt-4">
    <div class="col-md-6">
        <div class="card shadow-sm mb-4 clickable-chart" data-bs-toggle="modal" data-bs-target="#debtChartModal">
            <div class="card-header">Debt Trends</div>
            <div class="card-body">
                <canvas id="debtChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card shadow-sm mb-4 clickable-chart" data-bs-toggle="modal" data-bs-target="#doughChartModal">
            <div class="card-header">Dough Trends</div>
            <div class="card-body">
                <canvas id="doughChart"></canvas>
            </div>
        </div>
    </div>
</section>

<!-- Debt Chart Modal -->
<div class="modal fade" id="debtChartModal" tabindex="-1" aria-labelledby="debtChartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="debtChartModalLabel">Debt Trends Analysis</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <canvas id="debtChartExpanded"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Dough Chart Modal -->
<div class="modal fade" id="doughChartModal" tabindex="-1" aria-labelledby="doughChartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="doughChartModalLabel">Dough Trends Analysis</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <canvas id="doughChartExpanded"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
    // Chart data will be populated by Flask
    const debtData = {{ debt_chart_data | tojson }};
    const doughData = {{ dough_chart_data | tojson }};

    // Function to render a chart
    function renderChart(elementId, data, label, borderColor) {
        new Chart(document.getElementById(elementId), {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: label,
                    data: data.values,
                    borderColor: borderColor,
                    tension: 0.1,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Render initial charts
    renderChart('debtChart', debtData, 'Debt Amount', 'rgb(220, 53, 69)');
    renderChart('doughChart', doughData, 'Dough Amount', 'rgb(25, 135, 84)');

    // Render expanded charts when modals are shown
    document.getElementById('debtChartModal').addEventListener('shown.bs.modal', function () {
        renderChart('debtChartExpanded', debtData, 'Debt Amount', 'rgb(220, 53, 69)');
    });

    document.getElementById('doughChartModal').addEventListener('shown.bs.modal', function () {
        renderChart('doughChartExpanded', doughData, 'Dough Amount', 'rgb(25, 135, 84)');
    });
</script>

{% endblock %}
